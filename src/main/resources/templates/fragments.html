<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:fragment="head">
    <meta charset="UTF-8"/>
    <title>Watchlist</title>

    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.4.1/darkly/bootstrap.min.css" rel="stylesheet" integrity="sha384-rCA2D+D9QXuP2TomtQwd+uP50EHjpafN+wruul0sXZzX/Da7Txn4tB9aLMZV4DZm" crossorigin="anonymous">    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/styles.css">

</head>
<body>

<header th:fragment="header">
    <h3 th:text="${title}">Watchlist</h3>
</header>

<nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-dark navbar-inverse sticky-top">
    <div class="navbar-header">
        <a th:href="@{/}" class="navbar-brand">Watchlist</a>
        <a nav-item nav-link th:href="@{/search}">Search</a>
    </div>
    <div class="collapse navbar-collapse" id="navbarText">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse d-flex justify-content-end" id="navbarNavAltMarkup">
                <div th:if="${user != null}" class="navbar-nav">
                    <a class="nav-item nav-link" href="#"><span th:text="${'Hello, ' + user.username + '!'}"></span></a>
                    <a class="nav-item nav-link" th:href="@{/logout}">Logout</a>
                </div>
                <div th:unless="${user != null}" class="navbar-nav">
                    <a class="nav-item nav-link" th:href="@{/register}">Register</a>
                    <a class="nav-item nav-link" th:href="@{/login}">Login</a>
                </div>
            </div>
    </div>
</nav>

<th:block th:fragment="movielist" th:if="${movies != null}">
    <hr>
    <p th:if="${searchTerm != null}" th:text="${'Showing results 1 - ' + movies.size() + ' for: ' + searchTerm}"></p>
    <div class="row">
        <table class="table table-striped table-hover search-results">
            <tr th:each="movie : ${movies}">
                <td class="search-results-poster">
                    <img th:src="${movie.getPosterPath() != null ? url + movie.getPosterPath() :''}" alt />
                </td>
                <td>
                    <a th:href="@{/movie/view(id=${movie.getId()})}"><H4 th:text="${movie.getTitle() + ' ' + movie.getReleaseDate()}"></H4></a>
                    <em th:if="${!movie.getCrew().isEmpty()}">Directed by <th:block th:each="crew : ${movie.getCrew()}">
                        <span th:text="${crewStat.last ? crew.getName() : crew.getName() + ', '}"></span>
                    </th:block>
                    </em>
                    <p th:text="${movie.getOverview()}"></p>
                </td>
                <td>
                   <a th:if="${user != null and !isUserList}" class="btn btn-primary" th:href="@{/watchlist/add(id=${movie.getId()})}">Add to Watchlist</a>
                </td>
            </tr>
        </table>
    </div>
</th:block>

<div th:fragment="mainMovieInfo" class="col-md-10 main-film-top-margin">
    <div class="row">
        <div class="col-md-4 poster">
            <div class="center-block">
                <img th:src="${movie.getPosterPath() != null ? url + movie.getPosterPath() :''}" class="img-fluid" alt/>
            </div>
        </div>
        <div class="col-md-8">
            <div class="row main-film-info margin-right-offset" style="border-bottom:3px groove gray">
                <h1>
                    <span style="color: ghostwhite;" th:text="${movie.getTitle()}"></span><small th:text="${movie.getReleaseDate()}"></small>
                </h1>
            </div>
            <div th:if="${!movie.getOverview().isEmpty()}" class="row main-film-info">
                <h2>Synopsis</h2>
                <p th:text="${movie.getOverview()}"></p>
                <br />
            </div>
            <div th:if="${movie.getCast().size() > 0}" class="row main-film-info">
                <h2>Top Cast Members</h2>
            </div>
            <div class="row">
                <div th:each="castMember : ${movie.getCast()}" th:if="${castMemberStat.index < 10}" class="col-md-4 cast-display" th:text="${castMember.getName()}">
                </div>
            </div>
<!--            <div th:if="${movie.getComments() != null}" class="row main-film-info">-->
<!--                <h2 th:text="${'Comments from ' + user.getUsername()}"></h2>-->
<!--                <p th:text="${movie.getComments()}"></p>-->
<!--            </div>-->
        </div>
    </div>
    <br />
    <div th:if="${trailerUrl != null}" class="row embed-responsive embed-responsive-16by9 margin-right-offset">
        <iframe class="embed-responsive-item" th:src="${trailerUrl}" frameborder="0" allowfullscreen></iframe>
    </div>
</div>
</body>
</html>